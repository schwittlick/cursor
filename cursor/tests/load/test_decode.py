from cursor.load.compress import JsonCompressor
from cursor.load.decode import load_json


def test_json_decoder():
    enc = "{'base64(zip(o))': 'eJyrVsrNLy1OVbJSqFYqSCzJKAayoqOrlSqAtIGOglIllC4BSR \
     iaGZkZGJubGRrXxsaCBDNzU4tLEnMLIHLmBiYWpuYGeoYGphYWRrVABdmplWADY2sB4yQcFQ=='}"
    compressor = JsonCompressor()
    res = compressor.json_unzip(eval(enc))
    assert len(res["mouse"]) == 1
    assert len(res["keys"]) == 0


data = {
    "mouse": {
        "paths": [
            [
                {"x": 0.6979, "y": 0.7005, "ts": 1565089006.17},
                {"x": 0.6979, "y": 0.6991, "ts": 1565089006.18},
                {"x": 0.6982, "y": 0.6958, "ts": 1565089006.18},
                {"x": 0.6982, "y": 0.6921, "ts": 1565089006.19},
                {"x": 0.6987, "y": 0.6866, "ts": 1565089006.2},
                {"x": 0.6997, "y": 0.6778, "ts": 1565089006.21},
                {"x": 0.701, "y": 0.6648, "ts": 1565089006.21},
                {"x": 0.7031, "y": 0.6481, "ts": 1565089006.22},
                {"x": 0.7049, "y": 0.6324, "ts": 1565089006.23},
                {"x": 0.7065, "y": 0.6167, "ts": 1565089006.24},
                {"x": 0.707, "y": 0.6083, "ts": 1565089006.25},
                {"x": 0.6805, "y": 0.5542, "ts": 1565089006.96},
                {"x": 0.6802, "y": 0.5537, "ts": 1565089006.97},
                {"x": 0.6797, "y": 0.5537, "ts": 1565089006.98},
                {"x": 0.6797, "y": 0.5537, "ts": 1565089006.99},
                {"x": 0.6797, "y": 0.5537, "ts": 1565089007.0},
            ],
            [
                {"x": 0.6797, "y": 0.5523, "ts": 1565089007.12},
                {"x": 0.681, "y": 0.5481, "ts": 1565089007.13},
                {"x": 0.6844, "y": 0.5431, "ts": 1565089007.13},
                {"x": 0.6878, "y": 0.5394, "ts": 1565089007.14},
                {"x": 0.6922, "y": 0.5352, "ts": 1565089007.15},
                {"x": 0.6979, "y": 0.5319, "ts": 1565089007.16},
                {"x": 0.7047, "y": 0.5287, "ts": 1565089007.17},
                {"x": 0.7117, "y": 0.5273, "ts": 1565089007.18},
                {"x": 0.7185, "y": 0.5273, "ts": 1565089007.18},
                {"x": 0.7268, "y": 0.5273, "ts": 1565089007.19},
                {"x": 0.7336, "y": 0.5273, "ts": 1565089007.2},
                {"x": 0.7378, "y": 0.5273, "ts": 1565089007.21},
                {"x": 0.7396, "y": 0.5278, "ts": 1565089007.21},
                {"x": 0.7398, "y": 0.5278, "ts": 1565089007.22},
            ],
        ],
        "resolution": {"w": 3840, "h": 2160},
        "timestamp": 1565089006.12941,
    },
    "keys": [
        ["f", 1565089008.180005],
        ["f", 1565089008.299778],
        ["f", 1565089008.412063],
    ],
}


def test_new_version():
    decoded = load_json(str(data["mouse"]))
    assert len(decoded) == 2
    assert len(decoded[0]) == 16
    assert len(decoded[1]) == 14
